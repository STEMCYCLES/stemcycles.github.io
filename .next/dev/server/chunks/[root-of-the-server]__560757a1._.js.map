{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///Users/joshlew/Documents/STEMCYCLES/Websites/stemcycles.github.io/src/app/api/contact/route.js"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport nodemailer from \"nodemailer\";\n\nconst REQUIRED_FIELDS = [\"firstName\", \"lastName\", \"email\", \"role\"];\n\nexport async function POST(request) {\n  try {\n    const body = await request.json();\n    const missing = REQUIRED_FIELDS.filter((field) => !body?.[field]);\n\n    if (missing.length > 0) {\n      return NextResponse.json(\n        { error: `Missing required fields: ${missing.join(\", \")}` },\n        { status: 400 }\n      );\n    }\n\n    const transporter = buildTransport();\n    const toAddress = process.env.CONTACT_TO ?? \"info@stemcycles.com\";\n    const fromAddress = process.env.SMTP_FROM ?? process.env.SMTP_USER;\n\n    await transporter.sendMail({\n      from: fromAddress,\n      to: toAddress,\n      replyTo: body.email,\n      subject: `New Get Involved inquiry from ${body.firstName} ${body.lastName}`,\n      text: buildPlainText(body),\n      html: buildHtml(body),\n    });\n\n    return NextResponse.json({ success: true });\n  } catch (error) {\n    console.error(\"Contact form send failed\", error);\n    return NextResponse.json(\n      {\n        error: \"Unable to send your message right now. Please try again later.\",\n      },\n      { status: 500 }\n    );\n  }\n}\n\nfunction buildTransport() {\n  const host = process.env.SMTP_HOST;\n  const port = Number(process.env.SMTP_PORT ?? 587);\n  const user = process.env.SMTP_USER;\n  const pass = process.env.SMTP_PASS;\n\n  if (!host || !user || !pass) {\n    throw new Error(\"SMTP is not configured.\");\n  }\n\n  return nodemailer.createTransport({\n    host,\n    port,\n    secure: process.env.SMTP_SECURE === \"true\",\n    auth: {\n      user,\n      pass,\n    },\n  });\n}\n\nfunction buildPlainText(body) {\n  return `\nNew Get Involved submission\n\nName: ${body.firstName} ${body.lastName}\nEmail: ${body.email}\nRole: ${body.role}\n\nMessage:\n${body.message ?? \"(no message provided)\"}\n`.trim();\n}\n\nfunction buildHtml(body) {\n  return `\n    <h2>New Get Involved submission</h2>\n    <p><strong>Name:</strong> ${body.firstName} ${body.lastName}</p>\n    <p><strong>Email:</strong> ${body.email}</p>\n    <p><strong>Role:</strong> ${body.role}</p>\n    <p><strong>Message:</strong></p>\n    <p>${(body.message ?? \"No message provided\").replace(/\\n/g, \"<br/>\")}</p>\n  `;\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,kBAAkB;IAAC;IAAa;IAAY;IAAS;CAAO;AAE3D,eAAe,KAAK,OAAO;IAChC,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,UAAU,gBAAgB,MAAM,CAAC,CAAC,QAAU,CAAC,MAAM,CAAC,MAAM;QAEhE,IAAI,QAAQ,MAAM,GAAG,GAAG;YACtB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO,CAAC,yBAAyB,EAAE,QAAQ,IAAI,CAAC,OAAO;YAAC,GAC1D;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,cAAc;QACpB,MAAM,YAAY,QAAQ,GAAG,CAAC,UAAU,IAAI;QAC5C,MAAM,cAAc,QAAQ,GAAG,CAAC,SAAS,IAAI,QAAQ,GAAG,CAAC,SAAS;QAElE,MAAM,YAAY,QAAQ,CAAC;YACzB,MAAM;YACN,IAAI;YACJ,SAAS,KAAK,KAAK;YACnB,SAAS,CAAC,8BAA8B,EAAE,KAAK,SAAS,CAAC,CAAC,EAAE,KAAK,QAAQ,EAAE;YAC3E,MAAM,eAAe;YACrB,MAAM,UAAU;QAClB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC3C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,OAAO;QACT,GACA;YAAE,QAAQ;QAAI;IAElB;AACF;AAEA,SAAS;IACP,MAAM,OAAO,QAAQ,GAAG,CAAC,SAAS;IAClC,MAAM,OAAO,OAAO,QAAQ,GAAG,CAAC,SAAS,IAAI;IAC7C,MAAM,OAAO,QAAQ,GAAG,CAAC,SAAS;IAClC,MAAM,OAAO,QAAQ,GAAG,CAAC,SAAS;IAElC,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,MAAM;QAC3B,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO,4JAAU,CAAC,eAAe,CAAC;QAChC;QACA;QACA,QAAQ,QAAQ,GAAG,CAAC,WAAW,KAAK;QACpC,MAAM;YACJ;YACA;QACF;IACF;AACF;AAEA,SAAS,eAAe,IAAI;IAC1B,OAAO,CAAC;;;MAGJ,EAAE,KAAK,SAAS,CAAC,CAAC,EAAE,KAAK,QAAQ,CAAC;OACjC,EAAE,KAAK,KAAK,CAAC;MACd,EAAE,KAAK,IAAI,CAAC;;;AAGlB,EAAE,KAAK,OAAO,IAAI,wBAAwB;AAC1C,CAAC,CAAC,IAAI;AACN;AAEA,SAAS,UAAU,IAAI;IACrB,OAAO,CAAC;;8BAEoB,EAAE,KAAK,SAAS,CAAC,CAAC,EAAE,KAAK,QAAQ,CAAC;+BACjC,EAAE,KAAK,KAAK,CAAC;8BACd,EAAE,KAAK,IAAI,CAAC;;OAEnC,EAAE,CAAC,KAAK,OAAO,IAAI,qBAAqB,EAAE,OAAO,CAAC,OAAO,SAAS;EACvE,CAAC;AACH"}}]
}